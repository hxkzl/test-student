<!DOCTYPE html>
<html lang="zh-Hant" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿæœƒ | PKSH Student Council</title>
    <link rel="icon" type="image/png" href="å¤§é ­è²¼.jpg">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                fontFamily: {
                    sans: ['"Inter"', '"Noto Sans TC"', 'sans-serif'],
                },
                extend: {
                    colors: {
                        theme: {
                            50: '#f0fdfa',
                            100: '#ccfbf1',
                            200: '#99f6e4',
                            300: '#5eead4',
                            400: '#2dd4bf',
                            500: '#14b8a6', // Primary Teal
                            600: '#0d9488', 
                            700: '#0f766e',
                            800: '#115e59',
                            900: '#134e4a',
                        }
                    },
                    animation: {
                        'fade-up': 'fadeUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* ç»ç’ƒæ“¬æ…‹ */
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        .dark .glass {
            background: rgba(15, 23, 42, 0.9);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* [æ ¸å¿ƒ] å°è¦½åˆ—é˜²çˆ†è¨­å®š - å¼·åˆ¶æ©«å‘æ»‘å‹•ä¸æ›è¡Œ */
        .nav-scroll-container {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
            gap: 0.5rem;
            height: 100%;
            align-items: center;
            padding: 0 1rem;
        }
        .nav-scroll-container::-webkit-scrollbar { display: none; } /* Chrome */
        
        .nav-btn {
            flex-shrink: 0; /* ç¦æ­¢å£“ç¸® */
            white-space: nowrap; /* ç¦æ­¢æ›è¡Œ */
        }

        /* [ä¿®å¾©] è·‘é¦¬ç‡ˆå‹•ç•«è¨­å®š */
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; }
        .marquee-content { display: inline-block; animation: marquee 30s linear infinite; }
        .marquee-content:hover { animation-play-state: paused; }
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* é€£çµæ¨£å¼ */
        .news-content a:not(.btn-link) {
            color: #0d9488;
            text-decoration: underline;
            text-underline-offset: 4px;
            font-weight: 600;
            transition: color 0.2s;
        }
        .news-content a:not(.btn-link):hover { color: #0f766e; }
        .news-content a.btn-link { text-decoration: none !important; }

        /* å¡ç‰‡äº’å‹• */
        .hover-card { transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .hover-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1); }

        /* ç…§ç‰‡é®ç½© */
        .gallery-overlay {
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
        }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 dark:bg-slate-900 dark:text-slate-100 flex flex-col min-h-screen relative font-sans selection:bg-theme-100 selection:text-theme-800">

    <script>
        window.onerror = function(msg, url, line) {
            if (msg.includes('ResizeObserver')) return;
            // console.error("Error:", msg);
        };
    </script>

    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
        <div class="absolute -top-[10%] -right-[10%] w-[600px] h-[600px] bg-theme-200/20 rounded-full blur-[100px] dark:bg-theme-900/10"></div>
        <div class="absolute bottom-[-10%] left-[-10%] w-[500px] h-[500px] bg-blue-200/20 rounded-full blur-[100px] dark:bg-blue-900/10"></div>
    </div>

    <button onclick="window.scrollTo(0,0)" id="back-to-top" class="fixed bottom-8 right-8 z-50 bg-theme-600 text-white p-3 rounded-full shadow-lg opacity-0 pointer-events-none transition-all duration-300 hover:bg-theme-700 hover:scale-110 border border-theme-100 dark:border-slate-700 group">
        <i data-lucide="arrow-up" class="w-6 h-6 group-hover:-translate-y-0.5 transition-transform"></i>
    </button>

    <div class="relative z-20 bg-slate-900 text-white text-xs py-2.5 px-4 overflow-hidden">
        <div class="marquee-container flex items-center h-5">
            <div class="marquee-content font-mono tracking-wider opacity-90" id="marquee-text">Loading...</div>
        </div>
    </div>

    <header class="sticky top-0 z-40 glass shadow-sm transition-all duration-300">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16 sm:h-20 gap-4">
                
                <a href="#" class="flex-shrink-0 flex items-center gap-3 group" onclick="navigate('home')">
                    <img src="å¤§é ­è²¼.jpg" onerror="this.src='https://ui-avatars.com/api/?name=PKSH&background=0d9488&color=fff'" alt="Logo" class="w-10 h-10 rounded-full object-cover ring-2 ring-slate-100 dark:ring-slate-700 group-hover:ring-theme-400 transition-all">
                    <div class="hidden sm:flex flex-col">
                        <span class="text-lg font-bold tracking-tight leading-none text-slate-900 dark:text-white">åŒ—æ¸¯é«˜ä¸­<span class="text-theme-500">å­¸ç”Ÿæœƒ</span></span>
                        <span class="text-[10px] font-semibold text-slate-400 tracking-widest mt-0.5 uppercase">PKSH SU</span>
                    </div>
                </a>

                <div class="hidden xl:flex flex-1 min-w-0 items-center justify-center">
                    <nav class="nav-scroll-container">
                        <button class="nav-btn px-4 py-2 text-sm font-medium rounded-full transition-colors" onclick="navigate('home')" data-key="home">é¦–é </button>
                        <button class="nav-btn px-4 py-2 text-sm font-medium rounded-full transition-colors" onclick="navigate('events')" data-key="events">è¿‘æœŸæ´»å‹•</button>
                        <button class="nav-btn px-4 py-2 text-sm font-medium rounded-full transition-colors" onclick="navigate('gallery')" data-key="gallery">æ´»å‹•èŠ±çµ®</button>
                        <button class="nav-btn px-4 py-2 text-sm font-medium rounded-full transition-colors" onclick="navigate('clubs')" data-key="clubs">ç¤¾åœ˜å°ˆå€</button>
                        <button class="nav-btn px-4 py-2 text-sm font-medium rounded-full transition-colors" onclick="navigate('mailboxes')" data-key="mailboxes">ä¿¡ç®±å°ˆå€</button>
                        <button class="nav-btn px-4 py-2 text-sm font-medium rounded-full transition-colors" onclick="navigate('downloads')" data-key="downloads">è³‡æ–™ä¸‹è¼‰</button>
                        <button class="nav-btn px-4 py-2 text-sm font-medium rounded-full transition-colors" onclick="navigate('finance')" data-key="finance">è²¡å‹™æ˜ç´°</button>
                        <button class="nav-btn px-4 py-2 text-sm font-medium rounded-full transition-colors" onclick="navigate('meetings')" data-key="meetings">æœƒè­°ç´€éŒ„</button>
                        <button class="nav-btn px-4 py-2 text-sm font-medium rounded-full transition-colors" onclick="navigate('org')" data-key="org">çµ„ç¹”æ¶æ§‹</button>
                        <button class="nav-btn ml-2 px-5 py-2 rounded-full bg-theme-600 text-white text-sm font-bold shadow-md hover:bg-theme-700 hover:shadow-lg transition-all" onclick="navigate('contact')" data-key="contact">è¯çµ¡æˆ‘å€‘</button>
                    </nav>
                </div>

                <div class="flex items-center space-x-2 flex-shrink-0">
                    <button onclick="toggleSearch()" class="p-2 rounded-full text-slate-500 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-slate-800 transition">
                        <i data-lucide="search" class="w-5 h-5"></i>
                    </button>
                    <button onclick="toggleLang()" class="w-8 h-8 flex items-center justify-center text-xs font-bold border border-slate-200 dark:border-slate-700 rounded-lg text-slate-600 dark:text-slate-300 hover:border-theme-500 hover:text-theme-500 transition">
                        <span id="lang-display">EN</span>
                    </button>
                    <button onclick="toggleDarkMode()" class="p-2 rounded-full text-slate-500 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-slate-800 transition">
                        <i data-lucide="moon" id="dark-icon" class="w-5 h-5"></i>
                        <i data-lucide="sun" id="light-icon" class="w-5 h-5 hidden"></i>
                    </button>
                    <button id="menu-button" class="xl:hidden p-2 text-slate-600 dark:text-slate-200">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div id="mobile-menu" class="xl:hidden hidden bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl border-t border-slate-100 dark:border-slate-800 absolute w-full z-40 shadow-2xl animate-fade-in">
            <div class="p-4 space-y-1 max-h-[80vh] overflow-y-auto">
                <button class="block w-full text-left py-3 px-4 rounded-xl font-medium hover:bg-slate-50 dark:hover:bg-slate-800" onclick="navigate('home')" data-key="home">é¦–é </button>
                <button class="block w-full text-left py-3 px-4 rounded-xl font-medium hover:bg-slate-50 dark:hover:bg-slate-800" onclick="navigate('events')" data-key="events">è¿‘æœŸæ´»å‹•</button>
                <button class="block w-full text-left py-3 px-4 rounded-xl font-medium hover:bg-slate-50 dark:hover:bg-slate-800" onclick="navigate('gallery')" data-key="gallery">æ´»å‹•èŠ±çµ®</button>
                <button class="block w-full text-left py-3 px-4 rounded-xl font-medium hover:bg-slate-50 dark:hover:bg-slate-800" onclick="navigate('clubs')" data-key="clubs">ç¤¾åœ˜å°ˆå€</button>
                <button class="block w-full text-left py-3 px-4 rounded-xl font-medium hover:bg-slate-50 dark:hover:bg-slate-800" onclick="navigate('mailboxes')" data-key="mailboxes">ä¿¡ç®±å°ˆå€</button>
                <button class="block w-full text-left py-3 px-4 rounded-xl font-medium hover:bg-slate-50 dark:hover:bg-slate-800" onclick="navigate('downloads')" data-key="downloads">è³‡æ–™ä¸‹è¼‰</button>
                <button class="block w-full text-left py-3 px-4 rounded-xl font-medium hover:bg-slate-50 dark:hover:bg-slate-800" onclick="navigate('finance')" data-key="finance">è²¡å‹™æ˜ç´°</button>
                <button class="block w-full text-left py-3 px-4 rounded-xl font-medium hover:bg-slate-50 dark:hover:bg-slate-800" onclick="navigate('meetings')" data-key="meetings">æœƒè­°ç´€éŒ„</button>
                <button class="block w-full text-left py-3 px-4 rounded-xl font-medium hover:bg-slate-50 dark:hover:bg-slate-800" onclick="navigate('org')" data-key="org">çµ„ç¹”æ¶æ§‹</button>
                <button class="block w-full text-left py-3 px-4 rounded-xl font-bold text-theme-600 bg-theme-50 dark:bg-theme-900/20" onclick="navigate('contact')" data-key="contact">è¯çµ¡æˆ‘å€‘</button>
            </div>
        </div>
    </header>

    <div id="search-modal" class="fixed inset-0 z-50 bg-slate-900/40 backdrop-blur-md hidden flex flex-col pt-32 px-4 items-center animate-fade-in transition-opacity">
        <div class="w-full max-w-2xl relative transform transition-all scale-100">
            <input type="text" id="search-input" class="w-full bg-white dark:bg-slate-800 text-xl p-5 pl-6 rounded-2xl shadow-2xl dark:text-white border-none ring-1 ring-black/5 focus:ring-2 focus:ring-theme-500 focus:outline-none transition-all" placeholder="æœå°‹ç¶²ç«™å…§å®¹..." onkeyup="performSearch()">
            <button onclick="toggleSearch()" class="absolute right-5 top-5 text-gray-400 hover:text-theme-500 transition-colors">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>
        <div id="search-results" class="w-full max-w-2xl mt-4 space-y-2 overflow-y-auto max-h-[60vh] pb-10"></div>
    </div>

    <div id="lightbox-modal" class="fixed inset-0 z-50 bg-black/95 backdrop-blur-md hidden flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 pointer-events-none" onclick="closeLightbox()">
        <button onclick="closeLightbox()" class="absolute top-6 right-6 text-white/70 hover:text-white z-50 transition-colors bg-white/10 p-2 rounded-full">
            <i data-lucide="x" class="w-8 h-8"></i>
        </button>
        <div class="max-w-6xl w-full max-h-screen flex flex-col items-center justify-center">
            <img id="lightbox-img" src="" class="max-h-[85vh] max-w-full object-contain rounded-lg shadow-2xl transform scale-95 transition-transform duration-300" onclick="event.stopPropagation()">
            <p id="lightbox-caption" class="text-white/90 mt-4 text-center text-lg font-medium tracking-wide"></p>
        </div>
    </div>

    <main class="max-w-[1400px] mx-auto p-4 sm:p-6 lg:p-8 flex-grow w-full relative z-10 animate-fade-in" id="app-container">
    </main>

    <footer class="bg-white/50 dark:bg-slate-900/50 backdrop-blur border-t border-slate-200 dark:border-slate-800 mt-auto py-12 relative z-10">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <div class="flex justify-center items-center gap-3 mb-6">
                <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-theme-400 to-theme-600 p-0.5 grayscale hover:grayscale-0 transition-all">
                    <img src="å¤§é ­è²¼.jpg" onerror="this.src='https://ui-avatars.com/api/?name=PKSH&background=fff&color=0d9488'" class="w-full h-full rounded-full object-cover bg-white">
                </div>
                <span class="font-bold text-lg text-slate-800 dark:text-white tracking-tight">PKSH Student Council</span>
            </div>
            <div class="flex justify-center items-center gap-6 mb-8">
                <a href="https://www.instagram.com/pksh.su/" target="_blank" class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-100 dark:bg-slate-800 text-slate-400 hover:text-pink-500 hover:bg-white shadow-sm transition-all hover:-translate-y-1">
                    <i data-lucide="instagram" class="w-5 h-5"></i>
                </a>
                <a href="https://www.facebook.com/52PKSH/?locale=zh_TW" target="_blank" class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-100 dark:bg-slate-800 text-slate-400 hover:text-blue-600 hover:bg-white shadow-sm transition-all hover:-translate-y-1">
                    <i data-lucide="facebook" class="w-5 h-5"></i>
                </a>
                <a href="https://www.pksh.ylc.edu.tw/home" target="_blank" class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-100 dark:bg-slate-800 text-slate-400 hover:text-theme-600 hover:bg-white shadow-sm transition-all hover:-translate-y-1">
                    <i data-lucide="globe" class="w-5 h-5"></i>
                </a>
            </div>
            <p class="text-xs text-slate-400 font-medium tracking-wide">Â© 2025 åœ‹ç«‹åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿæœƒ. All Rights Reserved.</p>
        </div>
    </footer>

    <script type="module">
        // 1. å¼•å…¥ Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, getDoc, setDoc, addDoc, deleteDoc, doc, serverTimestamp, query, orderBy, limit, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        // ============================================
        // âš ï¸ Config (è«‹ç¢ºä¿é€™è£¡å¡«å…¥ä½ çš„ Firebase Config)
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyDWmy__e9_7YbhBTJNvLvGVglj-fOTFWMg",
            authDomain: "pksh-student-council.firebaseapp.com",
            projectId: "pksh-student-council",
            storageBucket: "pksh-student-council.firebasestorage.app",
            messagingSenderId: "142500679754",
            appId: "1:142500679754:web:a758dc9a8b5ae34f9296b3"
        };
        let db = null;
        let auth = null;

        try {
            if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                console.log("âœ… Firebase é€£ç·šæˆåŠŸï¼");
            } else {
                console.warn("âš ï¸ Firebase Config æœªè¨­å®šï¼Œç›®å‰ä½¿ç”¨éœæ…‹è³‡æ–™æ¨¡å¼ã€‚");
            }
        } catch (e) {
            console.error("Firebase åˆå§‹åŒ–å¤±æ•—:", e);
        }

        // --- éœæ…‹è³‡æ–™ (Fallback) ---
        const STATIC_DATA = {
            announcements: [
                { 
                    id: 'static_1', 
                    title_zh: 'å­¸ç”Ÿæœƒé€£çµæ¨¹', 
                    title_en: 'Student Union Link Tree', 
                    tag_zh: 'å…¬å‘Š', tag_en: 'Notice', 
                    date: '2026-01-01',
                    content_zh: 'https://linktr.ee/pkshsu?utm_source=ig&utm_medium=social&utm_content=link_in_bio&fbclid=PAb21jcAPC4qRleHRuA2FlbQIxMQBzcnRjBmFwcF9pZA81NjcwNjczNDMzNTI0MjcAAaeHqdgPGR_-3r8dZkSNWf5ppn5iFKdKdgi26JypXij6uoGGQUrU6CP1NAXAig_aem_CFVbEBehnQMXtEfUGpJ7LA', 
                    content_en: 'https://linktr.ee/pkshsu?utm_source=ig&utm_medium=social&utm_content=link_in_bio&fbclid=PAb21jcAPC4qRleHRuA2FlbQIxMQBzcnRjBmFwcF9pZA81NjcwNjczNDMzNTI0MjcAAaeHqdgPGR_-3r8dZkSNWf5ppn5iFKdKdgi26JypXij6uoGGQUrU6CP1NAXAig_aem_CFVbEBehnQMXtEfUGpJ7LA'
                }
            ],
            // å·²ç§»é™¤å‘Šç™½ç‰†è³‡æ–™
            events: [],
            finance: [],
            // [NEW] é è¨­ç…§ç‰‡
            photos: [
                { url: 'https://images.unsplash.com/photo-1523580494863-6f3031224c94?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80', title_zh: 'æ ¡åœ’ä¸€éš… (ç¯„ä¾‹)', title_en: 'Campus Corner' }
            ],
            clubs: [
                { name_zh: 'ç†±èˆç¤¾', name_en: 'Pop Dance Club', category: 'Dance', emoji: 'ğŸ’ƒ', ig: 'https://www.instagram.com/pkdc.20_flaming/' },
                { name_zh: 'ç†±éŸ³ç¤¾', name_en: 'Pop Music Club', category: 'Music', emoji: 'ğŸ¸', ig: 'https://www.instagram.com/pkhmc_/' },
                { name_zh: 'ç«¥è»ç¤¾', name_en: 'Scout Club', category: 'Service', emoji: 'ğŸ•ï¸', ig: 'https://www.instagram.com/pksh_circus_scout/' },
            ],
            orgLeaders: [
                { roleKey: 'role_pres', icon: 'ğŸ‘‘', name_zh: 'å¼µä½¾å‚‘', name_en: 'CHANG, YI-CHIEH', desc_zh: 'å°å…§ç¶œç†å…§å‹™ï¼Œä¸»æŒå¬é–‹æœƒå“¡ä»£è¡¨å¤§æœƒï¼Œå°å¤–ä»£è¡¨æœ¬æœƒï¼Œé…åˆå­¸æ ¡æ¨å±•å„é …æ´»å‹•ä¸¦è² è²¬ç¶œç†æœ¬æœƒäº‹å®œã€‚', desc_en: 'Manages internal affairs.' },
                { roleKey: 'role_vp', icon: 'â­', name_zh: 'ç‹é›…ç', name_en: 'WANG, YA-WEN', desc_zh: 'å”åŠ©æœƒé•·åŸ·è¡Œæœ¬æœƒäº‹å®œï¼Œæœƒé•·å› æ•…ç¼ºå¸­æ™‚ä»£ç†ä¹‹ã€‚', desc_en: 'Assists the President.' }
            ],
            orgDepts: [
                { roleKey: 'role_act', icon: 'ğŸ‰', chief_zh: 'é„­é›¨æ¶µ', chief_en: 'CHENG, YU-HAN', desc_zh: 'è² è²¬ç­–åŠƒåŠæ¨è¡Œæœ¬æœƒæ‰€èˆ‰è¾¦ä¹‹å„é¡æ´»å‹•ã€‚', desc_en: 'Activities planning.' },
                { roleKey: 'role_art', icon: 'ğŸ¨', chief_zh: 'æœ±å®ˆæ™´', chief_en: 'CHU, SHOU-CHING', deputy_zh: 'é»ƒç“Šç¾', deputy_en: 'HUANG, CHIUNG-MEI', desc_zh: 'è² è²¬æœ¬æœƒå­¸è—æ´»å‹•ã€æµ·å ±ã€å£å ±è¨­è¨ˆã€‚', desc_en: 'Art and Design.' },
                { roleKey: 'role_admin', icon: 'ğŸ“', chief_zh: 'è”¡ç§‰å®', chief_en: 'TSAI, PING-HUNG', deputy_zh: 'é¡å­ä’Ÿ', deputy_en: 'YEN, TZU-TAN', desc_zh: 'è² è²¬æœ¬æœƒé–‹æœƒé€šå‘Šã€æœƒè­°è¨˜éŒ„ã€‚', desc_en: 'Administration.' },
                { roleKey: 'role_ga', icon: 'ğŸ’°', chief_zh: 'è¶™èŠç¿Š', chief_en: 'CHAO, CHIH-YI', desc_zh: 'è² è²¬æœ¬æœƒç¶“è²»æ”¶æ”¯ï¼Œè²¡ç”¢ä¿ç®¡ã€‚', desc_en: 'General Affairs.' },
                { roleKey: 'role_pr', icon: 'ğŸ“¢', chief_zh: 'è¨±é›…ç³', chief_en: 'HSU, YA-LIN', desc_zh: 'è² è²¬æœ¬æœƒæœƒè­°ä¹‹è¯çµ¡åŠèˆ‰è¾¦æ´»å‹•ä¹‹è¯ç¹«ã€‚', desc_en: 'Public Relations.' },
                { roleKey: 'role_mobile', icon: 'ğŸ› ï¸', chief_zh: 'åŠ‰ä¹™è‘­', chief_en: 'LIU, YI-CHIA', desc_zh: 'è² è²¬æœ¬æœƒèˆ‰è¾¦ä¹‹å ´åœ°ä½ˆç½®ã€‚', desc_en: 'Logistics.' }
            ],
            meetings: [],
            downloads: []
        };

        let APP_DATA = JSON.parse(JSON.stringify(STATIC_DATA));
        let SYSTEM_SETTINGS = {
            marquee: 'ğŸ“¢ æ­¡è¿ä¾†åˆ°åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿæœƒå®˜æ–¹ç¶²ç«™ï¼'
        };

        const I18N = {
            zh: {
                home: 'é¦–é ', events: 'è¿‘æœŸæ´»å‹•', mailboxes: 'ä¿¡ç®±å°ˆå€', clubs: 'ç¤¾åœ˜å°ˆå€', downloads: 'è³‡æ–™ä¸‹è¼‰',
                contact: 'è¯çµ¡æˆ‘å€‘', org: 'çµ„ç¹”æ¶æ§‹', finance: 'è²¡å‹™æ˜ç´°', meetings: 'æœƒè­°ç´€éŒ„', admin: 'å¾Œå°ç®¡ç†',
                gallery: 'æ´»å‹•èŠ±çµ®',
                marquee: '', 
                heroTitle: 'åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿæœƒ',
                heroSubtitle: 'ä½ çš„è²éŸ³ï¼Œæˆ‘å€‘çš„è¡Œå‹•ã€‚å…±å‰µæ›´ç¾å¥½çš„æ ¡åœ’ç”Ÿæ´»ã€‚',
                btnComplaint: 'å‰å¾€ä¿¡ç®±å°ˆå€', news: 'æœ€æ–°å…¬å‘Š',
                financeTitle: 'è²¡å‹™æ˜ç´°', orgTitle: 'å­¸ç”Ÿæœƒçµ„ç¹”æ¶æ§‹', eventTitle: 'è¿‘æœŸæ´»å‹•ä¸€è¦½',
                meetingTitle: 'æœƒè­°è¨˜éŒ„å­˜æª”', clubTitle: 'ç¤¾åœ˜å°ˆå€', downloadTitle: 'è³‡æ–™ä¸‹è¼‰å°ˆå€',
                galleryTitle: 'ç²¾å½©æ´»å‹•èŠ±çµ®',
                rightsMailbox: 'å­¸æ¬Šä¿¡ç®±', rightsDesc: 'ç™¼ç¾æ ¡åœ’è¨­å‚™æå£ã€å°å­¸æ ¡æ”¿ç­–æœ‰ç–‘å•æˆ–å»ºè­°ï¼Ÿè«‹å¡«å¯«æ­¤è¡¨å–®ã€‚',
                anonMailbox: 'åŒ¿åä¿¡ç®±', anonDesc: 'å°å­¸ç”Ÿæœƒçš„æ–½æ”¿æ–¹é‡ã€æ´»å‹•è¦åŠƒæœ‰ä»»ä½•å»ºè­°ï¼Ÿæ­¡è¿åŒ¿åå¡«å¯«ã€‚',
                goToForm: 'å‰å¾€å¡«å¯«è¡¨å–®', searchPlaceholder: 'æœå°‹ç¶²ç«™å…§å®¹...', noResults: 'æ²’æœ‰æ‰¾åˆ°ç›¸é—œçµæœ',
                col_date: 'æ—¥æœŸ', col_item: 'é …ç›®', col_amount: 'é‡‘é¡',
                role_pres: 'æœƒé•·', role_vp: 'å‰¯æœƒé•·', role_admin: 'è¡Œæ”¿çµ„', role_act: 'æ´»å‹•çµ„', role_mobile: 'æ©Ÿå‹•çµ„',
                role_pr: 'å…¬é—œçµ„', role_ga: 'ç¸½å‹™çµ„', role_art: 'ç¾å®£çµ„', role_chief: 'çµ„é•·', role_deputy: 'å‰¯çµ„é•·',
                download_btn: 'ä¸‹è¼‰æª”æ¡ˆ',
                filter_all: 'å…¨éƒ¨', filter_academic: 'æ•™å‹™', filter_holiday: 'å‡æ—¥', filter_event: 'æ´»å‹•',
                login_title: 'å­¸ç”Ÿæœƒå¹¹éƒ¨ç™»å…¥', login_btn: 'ç™»å…¥', login_email: 'é›»å­éƒµä»¶', login_pwd: 'å¯†ç¢¼',
                admin_dashboard: 'ç®¡ç†å„€è¡¨æ¿', admin_news: 'å…¬å‘Šç®¡ç†', admin_events: 'æ´»å‹•ç®¡ç†', admin_photos: 'ç…§ç‰‡ç®¡ç†', admin_system: 'ç³»çµ±è¨­å®š', admin_logout: 'ç™»å‡º',
                add_btn: 'æ–°å¢', save_btn: 'å„²å­˜è¨­å®š', delete_btn: 'åˆªé™¤', no_data: 'æš«ç„¡è³‡æ–™',
                admin_finance: 'è²¡å‹™ç®¡ç†', admin_meetings: 'æœƒè­°è¨˜éŒ„', admin_downloads: 'ä¸‹è¼‰ç®¡ç†'
            },
            en: {
                home: 'Home', events: 'Events', mailboxes: 'Mailboxes', clubs: 'Clubs', downloads: 'Downloads',
                contact: 'Contact Us', org: 'Organization', finance: 'Finance', meetings: 'Minutes', admin: 'Admin Panel',
                gallery: 'Gallery',
                marquee: '', 
                heroTitle: 'PKSH Student Council',
                heroSubtitle: 'Your Voice, Our Action. Creating a better campus life together.',
                btnComplaint: 'Go to Mailboxes', news: 'Latest News',
                financeTitle: 'Financial Details', orgTitle: 'Organization', eventTitle: 'Upcoming Events',
                meetingTitle: 'Meeting Minutes', clubTitle: 'Student Clubs', downloadTitle: 'Download Zone',
                galleryTitle: 'Activity Gallery',
                rightsMailbox: 'Student Rights Mailbox', rightsDesc: 'Report damaged facilities or suggest policy changes.',
                anonMailbox: 'Anonymous Mailbox', anonDesc: 'Suggestions for the Student Council? Share your thoughts anonymously.',
                goToForm: 'Fill out Form', searchPlaceholder: 'Search news or events...', noResults: 'No results found',
                col_date: 'Date', col_item: 'Item', col_amount: 'Amount',
                role_pres: 'President', role_vp: 'Vice President', role_admin: 'Admin Dept', role_act: 'Activity Dept', role_mobile: 'Logistics Dept',
                role_pr: 'Public Relations', role_ga: 'General Affairs', role_art: 'Art & Design', role_chief: 'Chief', role_deputy: 'Deputy',
                download_btn: 'Download',
                filter_all: 'All', filter_academic: 'Academic', filter_holiday: 'Holiday', filter_event: 'Event',
                login_title: 'Staff Login', login_btn: 'Login', login_email: 'Email', login_pwd: 'Password',
                admin_dashboard: 'Dashboard', admin_news: 'Manage News', admin_events: 'Manage Events', admin_photos: 'Manage Photos', admin_system: 'System Settings', admin_logout: 'Logout',
                add_btn: 'Add', save_btn: 'Save Settings', delete_btn: 'Delete', no_data: 'No Data',
                admin_finance: 'Manage Finance', admin_meetings: 'Manage Minutes', admin_downloads: 'Manage Downloads'
            }
        };

        const APP_STATE = {
            view: 'home',
            lang: 'zh',
            darkMode: false,
            eventFilter: 'All',
            user: null, 
            adminTab: 'news', 
            isLoading: false
        };

        const t = (key) => I18N[APP_STATE.lang][key] || key;
        const isEn = () => APP_STATE.lang === 'en';

        const val = (data, field) => {
            if (!data) return '';
            if (isEn()) return data[field + '_en'] || data[field + '_zh'] || data[field] || '';
            return data[field + '_zh'] || data[field] || '';
        };

        function formatDateHelper(dateStr) {
            let month = '??';
            let day = '??';
            if (!dateStr) return { month, day };
            try {
                const parts = dateStr.replace(/-/g, '/').split('/');
                if (parts.length >= 2) {
                    if (parts.length === 3) { month = parts[1]; day = parts[2]; } else { month = parts[0]; day = parts[1]; }
                }
            } catch (e) { console.error("Date parse error", e); }
            return { month, day };
        }

        function formatContent(text) {
            if (!text) return '';
            if (/<[a-z][\s\S]*>/i.test(text) && !text.startsWith('http')) return text;
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            return text.replace(urlRegex, (url) => {
                const ytMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([\w-]+)/);
                if (ytMatch && ytMatch[1]) {
                    return `<div class="my-4 w-full aspect-video"><iframe src="https://www.youtube.com/embed/${ytMatch[1]}" class="w-full h-full rounded-2xl shadow-lg border-2 border-white dark:border-gray-700" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`;
                }
                if (url.toLowerCase().endsWith('.pdf')) {
                    let filename = 'ä¸‹è¼‰ PDF æ–‡ä»¶';
                    try { filename = decodeURIComponent(new URL(url).pathname.split('/').pop()); } catch(e){}
                    return `<a href="${url}" target="_blank" class="btn-link group block mt-3 w-full text-center bg-gradient-to-r from-red-50 to-white border border-red-200 text-red-600 rounded-xl py-3.5 hover:from-red-100 hover:to-red-50 hover:shadow-md transition-all font-bold"><i data-lucide="file-down" class="inline-block mr-2 w-5 h-5 group-hover:scale-110 transition-transform"></i>${filename}</a>`;
                }
                if (/\.(jpeg|jpg|gif|png)$/i.test(url)) {
                     return `<img src="${url}" class="mt-3 rounded-2xl shadow-lg max-h-80 mx-auto border-4 border-white dark:border-gray-700 hover:scale-[1.02] transition-transform" alt="Image">`;
                }
                return `<a href="${url}" target="_blank" class="text-theme-600 font-bold hover:text-theme-700 transition-colors inline-flex items-center gap-1 border-b-2 border-theme-200 hover:border-theme-500 pb-0.5">ğŸ”— é–‹å•Ÿé€£çµ <i data-lucide="external-link" class="w-3 h-3"></i></a>`;
            });
        }

        // --- Firebase Data Handling ---
        async function loadDataFromFirebase() {
            if (!db) return;
            try {
                APP_STATE.isLoading = true;
                const settingsRef = doc(db, "settings", "config");
                const settingsSnap = await getDoc(settingsRef);
                if (settingsSnap.exists()) {
                    const d = settingsSnap.data();
                    if(Array.isArray(d.marquee)) SYSTEM_SETTINGS.marquee = d.marquee;
                    else SYSTEM_SETTINGS.marquee = d.marquee || SYSTEM_SETTINGS.marquee;
                }
                updateMarquee();

                const qNews = query(collection(db, "announcements"), orderBy("date", "desc"));
                const snapNews = await getDocs(qNews);
                const fetchedNews = [];
                snapNews.forEach(doc => { fetchedNews.push({ id: doc.id, ...doc.data() }); });
                if(fetchedNews.length > 0) APP_DATA.announcements = [...fetchedNews, ...STATIC_DATA.announcements];

                const qEvents = query(collection(db, "events"), orderBy("date", "asc"));
                const snapEvents = await getDocs(qEvents);
                const fetchedEvents = [];
                snapEvents.forEach(doc => { fetchedEvents.push({ id: doc.id, ...doc.data() }); });
                if(fetchedEvents.length > 0) {
                    APP_DATA.events = [...fetchedEvents, ...STATIC_DATA.events];
                    APP_DATA.events.sort((a,b) => a.date.localeCompare(b.date));
                }

                const qFinance = query(collection(db, "finance"), orderBy("date", "desc"));
                const snapFinance = await getDocs(qFinance);
                const fetchedFinance = [];
                snapFinance.forEach(doc => fetchedFinance.push({ id: doc.id, ...doc.data() }));
                if(fetchedFinance.length > 0) APP_DATA.finance = fetchedFinance;

                const qMeetings = query(collection(db, "meetings"), orderBy("date", "desc"));
                const snapMeetings = await getDocs(qMeetings);
                const fetchedMeetings = [];
                snapMeetings.forEach(doc => fetchedMeetings.push({ id: doc.id, ...doc.data() }));
                if(fetchedMeetings.length > 0) APP_DATA.meetings = fetchedMeetings;

                const qDownloads = query(collection(db, "downloads"), orderBy("date", "desc"));
                const snapDownloads = await getDocs(qDownloads);
                const fetchedDownloads = [];
                snapDownloads.forEach(doc => fetchedDownloads.push({ id: doc.id, ...doc.data() }));
                if(fetchedDownloads.length > 0) APP_DATA.downloads = fetchedDownloads;

                const qPhotos = query(collection(db, "photos"), orderBy("timestamp", "desc"));
                const snapPhotos = await getDocs(qPhotos);
                const fetchedPhotos = [];
                snapPhotos.forEach(doc => fetchedPhotos.push({ id: doc.id, ...doc.data() }));
                if(fetchedPhotos.length > 0) APP_DATA.photos = fetchedPhotos;

                // ç¢ºä¿ View ä¸ç‚ºç©º
                if(!APP_STATE.view) APP_STATE.view = 'home';
                render();
            } catch (error) {
                console.log("Firebase è®€å–å¤±æ•—:", error);
            } finally {
                APP_STATE.isLoading = false;
            }
        }

        // --- Auth & Admin Logic ---
        if (auth) {
            onAuthStateChanged(auth, (user) => {
                APP_STATE.user = user;
                if (APP_STATE.view === 'admin') render(); 
            });
        }

        window.handleLogin = async (e) => {
            e.preventDefault();
            const email = document.getElementById('admin-email').value;
            const pwd = document.getElementById('admin-pwd').value;
            try {
                await signInWithEmailAndPassword(auth, email, pwd);
                Swal.fire({ icon: 'success', title: 'ç™»å…¥æˆåŠŸ', timer: 1500, showConfirmButton: false });
            } catch (error) {
                Swal.fire('ç™»å…¥å¤±æ•—', 'è«‹æª¢æŸ¥å¸³è™Ÿå¯†ç¢¼', 'error');
            }
        };

        window.handleLogout = async () => {
            try {
                await signOut(auth);
                Swal.fire({ icon: 'success', title: 'å·²ç™»å‡º', timer: 1000, showConfirmButton: false });
            } catch (error) {
                console.error(error);
            }
        };

        window.switchAdminTab = (tab) => {
            APP_STATE.adminTab = tab;
            render();
        }

        window.autoTranslate = async (sourceId, targetId) => {
            const sourceText = document.getElementById(sourceId).value;
            const targetInput = document.getElementById(targetId);
            if (!sourceText) return Swal.fire('è«‹å…ˆè¼¸å…¥ä¸­æ–‡', '', 'warning');
            targetInput.value = 'ç¿»è­¯ä¸­...';
            targetInput.disabled = true;
            try {
                const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(sourceText)}&langpair=zh-TW|en-US`);
                const data = await res.json();
                if (data.responseData && data.responseData.translatedText) {
                    targetInput.value = data.responseData.translatedText;
                } else {
                    targetInput.value = '';
                    Swal.fire('ç¿»è­¯å¤±æ•—', 'è«‹æ‰‹å‹•è¼¸å…¥', 'error');
                }
            } catch (e) {
                console.error(e);
                targetInput.value = '';
                Swal.fire('é€£ç·šéŒ¯èª¤', 'è«‹ç¨å¾Œå†è©¦', 'error');
            } finally {
                targetInput.disabled = false;
            }
        };

        // CRUD Helpers
        window.addNews = async () => {
            const title_zh = document.getElementById('news-title-zh').value;
            const title_en = document.getElementById('news-title-en').value;
            const content_zh = document.getElementById('news-content-zh').value;
            const content_en = document.getElementById('news-content-en').value;
            const date = document.getElementById('news-date').value;
            if(!title_zh || !date) return Swal.fire('æ¬„ä½æœªå¡«', 'è«‹å¡«å¯«ä¸­æ–‡æ¨™é¡Œèˆ‡æ—¥æœŸ', 'warning');
            try {
                await addDoc(collection(db, "announcements"), {
                    title_zh, title_en: title_en || title_zh, content_zh, content_en: content_en || content_zh,
                    tag_zh: 'å…¬å‘Š', tag_en: 'Notice', date, timestamp: serverTimestamp()
                });
                Swal.fire('æ–°å¢æˆåŠŸ', '', 'success'); await loadDataFromFirebase();
            } catch(e) { Swal.fire('éŒ¯èª¤', e.message, 'error'); }
        }

        window.addEvent = async () => {
            const title_zh = document.getElementById('event-title-zh').value;
            const title_en = document.getElementById('event-title-en').value;
            const date = document.getElementById('event-date').value;
            const time = document.getElementById('event-time').value;
            const loc = document.getElementById('event-loc').value;
            const type = document.getElementById('event-type').value;
            const link = document.getElementById('event-link').value;
            if(!title_zh || !date) return Swal.fire('æ¬„ä½æœªå¡«', 'è«‹å¡«å¯«å®Œæ•´è³‡è¨Š', 'warning');
            try {
                await addDoc(collection(db, "events"), {
                    title_zh, title_en: title_en || title_zh, date, time, location_zh: loc, location_en: loc,
                    type, link: link || '', timestamp: serverTimestamp()
                });
                Swal.fire('æ–°å¢æˆåŠŸ', '', 'success'); await loadDataFromFirebase();
            } catch(e) { Swal.fire('éŒ¯èª¤', e.message, 'error'); }
        }

        window.addFinance = async () => {
            const date = document.getElementById('fin-date').value;
            const item = document.getElementById('fin-item').value;
            let amount = parseInt(document.getElementById('fin-amount').value);
            const type = document.getElementById('fin-type').value;
            if(!date || !item || !amount) return Swal.fire('è³‡æ–™ä¸å…¨', '', 'warning');
            if (type === 'Out') amount = -Math.abs(amount); else amount = Math.abs(amount);
            try {
                await addDoc(collection(db, "finance"), {
                    date, item_zh: item, item_en: item, amount, type, timestamp: serverTimestamp()
                });
                Swal.fire('å·²æ–°å¢è²¡å‹™', '', 'success'); await loadDataFromFirebase(); render(); 
            } catch(e) { Swal.fire('éŒ¯èª¤', e.message, 'error'); }
        }

        window.addMeeting = async () => {
            const date = document.getElementById('mt-date').value;
            const title = document.getElementById('mt-title').value;
            const link = document.getElementById('mt-link').value; 
            if(!date || !title) return Swal.fire('è³‡æ–™ä¸å…¨', '', 'warning');
            try {
                await addDoc(collection(db, "meetings"), {
                    date, title_zh: title, title_en: title, file: link || '#', timestamp: serverTimestamp()
                });
                Swal.fire('å·²æ–°å¢æœƒè­°è¨˜éŒ„', '', 'success'); await loadDataFromFirebase(); render();
            } catch(e) { Swal.fire('éŒ¯èª¤', e.message, 'error'); }
        }

        window.addDownload = async () => {
            const date = document.getElementById('dl-date').value;
            const title = document.getElementById('dl-title').value;
            const link = document.getElementById('dl-link').value;
            const type = document.getElementById('dl-type').value;
            if(!date || !title || !link) return Swal.fire('è³‡æ–™ä¸å…¨', '', 'warning');
            try {
                await addDoc(collection(db, "downloads"), {
                    date, title_zh: title, title_en: title, file: link, type, timestamp: serverTimestamp()
                });
                Swal.fire('å·²æ–°å¢ä¸‹è¼‰', '', 'success'); await loadDataFromFirebase(); render();
            } catch(e) { Swal.fire('éŒ¯èª¤', e.message, 'error'); }
        }

        window.addPhoto = async () => {
            const url = document.getElementById('photo-url').value;
            const title_zh = document.getElementById('photo-title-zh').value;
            const title_en = document.getElementById('photo-title-en').value;
            if(!url) return Swal.fire('è«‹è¼¸å…¥åœ–ç‰‡ç¶²å€', '', 'warning');
            try {
                await addDoc(collection(db, "photos"), {
                    url, title_zh: title_zh || 'æ´»å‹•ç…§ç‰‡', title_en: title_en || 'Activity Photo', timestamp: serverTimestamp()
                });
                Swal.fire('æ–°å¢æˆåŠŸ', '', 'success'); await loadDataFromFirebase();
            } catch(e) { Swal.fire('éŒ¯èª¤', e.message, 'error'); }
        }

        window.saveSystemSettings = async () => {
            const marqueeText = document.getElementById('system-marquee').value;
            const marqueeArray = marqueeText.split('|').map(s => s.trim()).filter(s => s);
            try {
                await setDoc(doc(db, "settings", "config"), { marquee: marqueeArray.length > 1 ? marqueeArray : marqueeText });
                SYSTEM_SETTINGS.marquee = marqueeArray.length > 1 ? marqueeArray : marqueeText;
                updateMarquee();
                Swal.fire('è¨­å®šå·²å„²å­˜', 'è·‘é¦¬ç‡ˆå·²æ›´æ–°', 'success');
            } catch(e) { Swal.fire('å„²å­˜å¤±æ•—', e.message, 'error'); }
        }

        window.deleteItem = async (collectionName, id) => {
            if(!db) return;
            const result = await Swal.fire({ title: 'ç¢ºå®šåˆªé™¤ï¼Ÿ', icon: 'warning', showCancelButton: true });
            if(result.isConfirmed) {
                try {
                    await deleteDoc(doc(db, collectionName, id));
                    Swal.fire('å·²åˆªé™¤', '', 'success'); await loadDataFromFirebase(); render();
                } catch(e) { Swal.fire('åˆªé™¤å¤±æ•—', 'ç„¡æ³•åˆªé™¤éœæ…‹è³‡æ–™æˆ–æ¬Šé™ä¸è¶³', 'error'); }
            }
        }

        // --- Logic ---
        function updateMarquee() {
            const el = document.getElementById('marquee-text');
            if(!el) return;
            let content = '';
            if (Array.isArray(SYSTEM_SETTINGS.marquee)) {
                content = SYSTEM_SETTINGS.marquee.join(' &nbsp;&nbsp;&nbsp;&nbsp;âœ¦&nbsp;&nbsp;&nbsp;&nbsp; ');
            } else {
                content = SYSTEM_SETTINGS.marquee;
            }
            el.innerHTML = content;
        }

        window.toggleSearch = () => {
            const modal = document.getElementById('search-modal');
            const input = document.getElementById('search-input');
            const resultDiv = document.getElementById('search-results');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                setTimeout(() => { modal.classList.remove('opacity-0'); input.focus(); }, 10);
                input.placeholder = t('searchPlaceholder');
            } else {
                modal.classList.add('opacity-0');
                setTimeout(() => { modal.classList.add('hidden'); modal.classList.remove('flex'); resultDiv.innerHTML = ''; input.value = ''; }, 300);
            }
        };
        window.performSearch = () => {
            const queryText = document.getElementById('search-input').value.toLowerCase();
            const resultsDiv = document.getElementById('search-results');
            if (queryText.length < 2) {
                resultsDiv.innerHTML = '';
                return;
            }
            const hits = [];
            APP_DATA.announcements.forEach(a => {
                const title = val(a, 'title');
                if (title.toLowerCase().includes(queryText)) hits.push({ type: isEn()?'News':'å…¬å‘Š', title: title, date: a.date, icon: 'bell' });
            });
            APP_DATA.events.forEach(e => {
                const title = val(e, 'title');
                if (title.toLowerCase().includes(queryText)) hits.push({ type: isEn()?'Event':'æ´»å‹•', title: title, date: e.date, icon: 'calendar' });
            });
            if (hits.length === 0) {
                resultsDiv.innerHTML = `<div class="text-center text-white/80 text-lg mt-10 font-medium">${t('noResults')}</div>`;
            } else {
                resultsDiv.innerHTML = hits.map(h => `
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl flex items-center gap-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-all shadow-md hover:scale-[1.02]">
                        <div class="bg-theme-50 dark:bg-theme-900/30 p-2.5 rounded-full text-theme-600 dark:text-theme-400"><i data-lucide="${h.icon}"></i></div>
                        <div>
                            <p class="font-bold dark:text-white text-lg">${h.title}</p>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-gray-500 dark:text-gray-300 font-bold">${h.type}</span>
                                <span class="text-xs text-gray-400">${h.date}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
                lucide.createIcons();
            }
        };

        window.openLightbox = (url, caption) => {
            const modal = document.getElementById('lightbox-modal');
            const img = document.getElementById('lightbox-img');
            const text = document.getElementById('lightbox-caption');
            img.src = url;
            text.innerText = caption;
            modal.classList.remove('hidden', 'opacity-0', 'pointer-events-none');
        };
        window.closeLightbox = () => {
            const modal = document.getElementById('lightbox-modal');
            modal.classList.add('opacity-0', 'pointer-events-none');
            setTimeout(() => modal.classList.add('hidden'), 300);
        };

        // --- Render Functions ---
        function renderHome() {
            const announcements = APP_DATA.announcements;
            const newsHtml = announcements.map(item => `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all border-l-[6px] border-theme-500 hover-lift relative overflow-hidden">
                    <div class="flex justify-between items-start mb-2 relative z-10">
                        <span class="text-xs font-bold text-theme-600 dark:text-theme-400 uppercase tracking-wider bg-theme-50 dark:bg-theme-900/30 px-2 py-1 rounded">${val(item, 'tag')}</span>
                        <span class="text-xs text-gray-400 font-mono">${item.date}</span>
                    </div>
                    <h3 class="text-xl font-bold mb-3 dark:text-white leading-tight relative z-10">${val(item, 'title')}</h3>
                    ${item.content_zh ? `<div class="text-gray-600 dark:text-gray-300 overflow-x-auto news-content leading-relaxed relative z-10">${formatContent(val(item, 'content'))}</div>` : ''}
                </div>
            `).join('');

            // å³å´åŠŸèƒ½ï¼šæ´»å‹•å€’æ•¸ + æœ€æ–°ç…§ç‰‡é è¦½
            let rightSideHtml = '';
            
            // 1. æ´»å‹•å€’æ•¸
            let nextEventHtml = `<div class="p-8 text-center text-gray-400 dark:text-gray-500 font-medium">æš«ç„¡å³å°‡åˆ°ä¾†çš„æ´»å‹•</div>`;
            const futureEvents = APP_DATA.events.filter(e => new Date(e.date) >= new Date());
            if (futureEvents.length > 0) {
                const nextEv = futureEvents[0]; 
                const daysLeft = Math.ceil((new Date(nextEv.date) - new Date()) / (1000 * 60 * 60 * 24));
                nextEventHtml = `
                    <div class="text-center relative z-10">
                        <span class="text-xs font-black text-gray-400 dark:text-gray-500 uppercase tracking-[0.2em]">NEXT EVENT</span>
                        <h3 class="text-2xl font-black mt-3 dark:text-white bg-clip-text text-transparent bg-gradient-to-r from-theme-500 to-blue-500">${val(nextEv, 'title')}</h3>
                        <div class="my-6 relative inline-block">
                            <span class="text-6xl font-black text-theme-500 drop-shadow-sm">${daysLeft}</span>
                            <span class="text-gray-400 font-bold block mt-1 text-sm tracking-widest">DAYS LEFT</span>
                        </div>
                        <p class="text-sm text-gray-500 font-medium bg-gray-100 dark:bg-gray-700/50 py-2 rounded-lg"><i data-lucide="calendar" class="inline w-4 h-4 mb-0.5 mr-1"></i> ${nextEv.date} @ ${val(nextEv, 'location')}</p>
                    </div>
                `;
            }

            // 2. æœ€æ–°ç…§ç‰‡é è¦½
            let latestPhotoHtml = '';
            if(APP_DATA.photos && APP_DATA.photos.length > 0) {
                const p = APP_DATA.photos[0];
                latestPhotoHtml = `
                    <div class="bg-white dark:bg-gray-800 p-1 rounded-3xl shadow-lg border border-gray-100 dark:border-gray-700 mt-8 group cursor-pointer" onclick="navigate('gallery')">
                        <div class="relative overflow-hidden rounded-[20px] aspect-video">
                            <img src="${p.url}" class="w-full h-full object-cover transform group-hover:scale-110 transition duration-700">
                            <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition duration-300">
                                <span class="text-white font-bold flex items-center gap-2"><i data-lucide="image" class="w-5 h-5"></i> æŸ¥çœ‹æ´»å‹•èŠ±çµ®</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="bg-gradient-to-br from-theme-500 via-theme-600 to-blue-600 text-white rounded-3xl p-8 sm:p-12 mb-12 shadow-2xl shadow-theme-500/20 relative overflow-hidden flex flex-col md:flex-row items-center justify-between gap-8 animate-fade-in">
                    <div class="absolute top-0 right-0 -mr-20 -mt-20 w-96 h-96 bg-white/10 rounded-full blur-3xl animate-float"></div>
                    <div class="absolute bottom-0 left-0 -ml-20 -mb-20 w-72 h-72 bg-blue-400/20 rounded-full blur-3xl animate-float" style="animation-delay: 1s;"></div>
                    
                    <div class="relative z-10 text-center md:text-left max-w-xl">
                        <h1 class="text-4xl sm:text-5xl font-black mb-6 tracking-tight leading-tight drop-shadow-lg">${t('heroTitle')}</h1>
                        <p class="text-lg sm:text-xl opacity-90 font-medium leading-relaxed max-w-lg">${t('heroSubtitle')}</p>
                        <button class="mt-8 bg-white text-theme-600 font-black py-3.5 px-8 rounded-full hover:bg-gray-50 transition shadow-lg hover:shadow-2xl transform hover:-translate-y-1 active:scale-95 duration-200 flex items-center gap-2 mx-auto md:mx-0 group text-lg">
                            ${t('btnComplaint')} <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                        </button>
                    </div>
                    <div class="relative z-10 flex-shrink-0 animate-float">
                        <div class="absolute inset-0 bg-white/20 rounded-full blur-2xl transform scale-110"></div>
                        <img src="å¤§é ­è²¼.jpg" onerror="this.src='https://ui-avatars.com/api/?name=PKSH&background=0d9488&color=fff&size=200'" class="relative w-40 h-40 md:w-56 md:h-56 rounded-full border-[6px] border-white/30 shadow-2xl object-cover">
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 space-y-6">
                        <h2 class="text-2xl font-bold dark:text-white flex items-center gap-3"><span class="bg-theme-100 dark:bg-theme-900/30 p-2 rounded-lg text-theme-600 dark:text-theme-400"><i data-lucide="bell" class="w-6 h-6"></i></span> ${t('news')}</h2>
                        <div class="grid gap-6 md:grid-cols-1">${newsHtml}</div>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-xl border border-gray-100 dark:border-gray-700 sticky top-28 overflow-hidden hover-lift">
                            <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-theme-400 to-blue-500"></div>
                            ${nextEventHtml}
                        </div>
                        
                        ${latestPhotoHtml}

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-lg border border-gray-100 dark:border-gray-700">
                            <h3 class="font-bold text-gray-800 dark:text-white mb-5 flex items-center gap-2 text-lg"><i data-lucide="link" class="text-blue-500"></i> å¸¸ç”¨é€£çµ</h3>
                            <div class="space-y-3">
                                <a href="https://www.pksh.ylc.edu.tw/" target="_blank" class="block p-4 bg-gray-50 dark:bg-gray-700/50 rounded-2xl hover:bg-blue-50 dark:hover:bg-blue-900/20 transition flex items-center justify-between group border border-transparent hover:border-blue-200 dark:hover:border-blue-800">
                                    <span class="font-bold text-gray-700 dark:text-gray-200 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">ğŸ« å­¸æ ¡å®˜ç¶²</span>
                                    <i data-lucide="external-link" class="w-4 h-4 text-gray-400 group-hover:text-blue-500"></i>
                                </a>
                                <a href="https://school.ylc.edu.tw/" target="_blank" class="block p-4 bg-gray-50 dark:bg-gray-700/50 rounded-2xl hover:bg-green-50 dark:hover:bg-green-900/20 transition flex items-center justify-between group border border-transparent hover:border-green-200 dark:hover:border-green-800">
                                    <span class="font-bold text-gray-700 dark:text-gray-200 group-hover:text-green-600 dark:group-hover:text-green-400 transition-colors">ğŸ“Š æˆç¸¾æŸ¥è©¢</span>
                                    <i data-lucide="external-link" class="w-4 h-4 text-gray-400 group-hover:text-green-500"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderGallery() {
            const photos = APP_DATA.photos;
            const galleryHtml = photos.length > 0 ? photos.map(p => `
                <div class="break-inside-avoid mb-6 cursor-zoom-in group relative overflow-hidden rounded-2xl shadow-lg border border-gray-100 dark:border-gray-700" onclick="openLightbox('${p.url}', '${val(p, 'title')}')">
                    <img src="${p.url}" alt="${val(p, 'title')}" class="w-full h-auto object-cover transform group-hover:scale-105 transition duration-700 ease-out">
                    <div class="gallery-overlay absolute inset-0 opacity-0 group-hover:opacity-100 transition duration-300 flex items-end p-6">
                        <p class="text-white font-bold text-lg transform translate-y-4 group-hover:translate-y-0 transition duration-300">${val(p, 'title')}</p>
                    </div>
                </div>
            `).join('') : `<p class="col-span-full text-center text-gray-500 py-20 font-medium text-lg">ç›®å‰æ²’æœ‰æ´»å‹•ç…§ç‰‡ï¼Œæ•¬è«‹æœŸå¾…ï¼</p>`;

            return `
                <div class="text-center mb-10 animate-fade-in">
                    <h1 class="text-4xl font-black mb-2 text-theme-600 dark:text-theme-400 tracking-tight">${t('galleryTitle')}</h1>
                    <div class="w-20 h-1.5 bg-theme-200 dark:bg-theme-800 rounded-full mx-auto"></div>
                </div>
                <div class="columns-1 md:columns-2 lg:columns-3 gap-6 space-y-6 animate-fade-in px-2">
                    ${galleryHtml}
                </div>
            `;
        }

        function renderEvents() {
            const filter = APP_STATE.eventFilter;
            const filteredEvents = filter === 'All' 
                ? APP_DATA.events 
                : APP_DATA.events.filter(e => e.type === filter);
            const eventsHtml = filteredEvents.length > 0 ? filteredEvents.map(ev => {
                const { month, day } = formatDateHelper(ev.date);
                
                return `
                <div class="flex items-center bg-white dark:bg-gray-800 p-5 rounded-2xl shadow-md mb-5 border-l-[6px] ${ev.type === 'Holiday' ? 'border-red-500' : ev.type === 'Academic' ? 'border-blue-500' : 'border-theme-500'} hover:shadow-xl hover:-translate-y-1 transition-all duration-300 group">
                    <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-xl text-center min-w-[90px] border border-gray-100 dark:border-gray-600 group-hover:border-theme-200 transition-colors">
                        <span class="block text-2xl font-black text-gray-800 dark:text-white">${day}</span>
                        <span class="block text-xs font-bold text-gray-500 uppercase mt-1">${month}æœˆ</span>
                    </div>
                    <div class="ml-6 flex-grow">
                        <div class="flex justify-between items-start">
                            <h3 class="text-xl font-bold dark:text-white group-hover:text-theme-600 transition-colors">${val(ev, 'title')}</h3>
                            <span class="text-xs px-2.5 py-1 rounded-full font-bold tracking-wide ${ev.type==='Holiday'?'bg-red-100 text-red-600':ev.type==='Academic'?'bg-blue-100 text-blue-600':'bg-theme-50 text-theme-600 dark:bg-theme-900/30 dark:text-theme-400'}">${isEn() ? ev.type : (ev.type==='Holiday'?'å‡æ—¥':ev.type==='Academic'?'æ•™å‹™':'æ´»å‹•')}</span>
                        </div>
                        <p class="text-sm text-gray-500 font-medium flex items-center gap-2 mt-2">
                            <span class="flex items-center"><i data-lucide="map-pin" class="w-3.5 h-3.5 mr-1"></i> ${val(ev, 'location')}</span>
                            <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                            <span class="flex items-center"><i data-lucide="clock" class="w-3.5 h-3.5 mr-1"></i> ${ev.time}</span>
                        </p>
                        ${ev.link ? `
                            <a href="${ev.link}" target="_blank" class="inline-flex items-center mt-3 text-sm text-theme-600 dark:text-theme-400 font-bold hover:underline decoration-2 underline-offset-2">
                                ç›¸é—œé€£çµ/å ±å <i data-lucide="external-link" class="w-3.5 h-3.5 ml-1"></i>
                            </a>
                        ` : ''}
                    </div>
                </div>
            `}).join('') : `<div class="text-center text-gray-400 py-20 font-medium bg-gray-50 dark:bg-gray-800/50 rounded-2xl">æ­¤åˆ†é¡æš«ç„¡æ´»å‹•</div>`;
            const makeBtn = (type, label) => `
                <button onclick="setEventFilter('${type}')" class="px-6 py-2.5 rounded-full text-sm font-bold transition-all transform active:scale-95 ${APP_STATE.eventFilter === type ? 'bg-theme-600 text-white shadow-lg ring-2 ring-theme-200' : 'bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 shadow-sm border border-gray-200 dark:border-gray-700'}">
                    ${label}
                </button>
            `;
            return `
                <div class="max-w-4xl mx-auto">
                    <div class="text-center mb-10">
                        <h1 class="text-4xl font-black text-theme-600 dark:text-theme-400 tracking-tight mb-2">${t('eventTitle')}</h1>
                        <div class="flex justify-center gap-3 flex-wrap animate-fade-in mt-6">
                            ${makeBtn('All', t('filter_all'))}
                            ${makeBtn('Academic', t('filter_academic'))}
                            ${makeBtn('Holiday', t('filter_holiday'))}
                            ${makeBtn('Activity', t('filter_event'))}
                        </div>
                    </div>
                    <div class="animate-fade-in space-y-4">
                        ${eventsHtml}
                    </div>
                </div>
            `;
        }

        window.setEventFilter = (filter) => {
            APP_STATE.eventFilter = filter;
            render();
        }

        function renderOrg() {
            const leadersHtml = APP_DATA.orgLeaders.map(l => `
                <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-lg flex flex-col items-center text-center border-t-[6px] border-theme-500 hover:scale-105 transition-all duration-300 hover:shadow-2xl">
                    <div class="text-7xl mb-6 animate-float filter drop-shadow-md">${l.icon}</div>
                    <h3 class="text-2xl font-black text-theme-600 dark:text-theme-400 tracking-tight mb-1">${t(l.roleKey)}</h3>
                    <div class="w-12 h-1 bg-gray-200 dark:bg-gray-700 rounded-full mb-4"></div>
                    <p class="text-xl font-bold dark:text-white mb-3 uppercase tracking-wide">${val(l, 'name')}</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed font-medium bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl w-full text-justify">${val(l, 'desc')}</p>
                </div>
            `).join('');
            const deptsHtml = APP_DATA.orgDepts.map(d => `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md hover:-translate-y-2 transition-all duration-300 h-full border border-gray-100 dark:border-gray-700 group hover:border-theme-300">
                    <div class="flex items-center gap-4 mb-5 pb-3 border-b border-gray-100 dark:border-gray-700">
                        <span class="text-4xl filter grayscale group-hover:grayscale-0 transition duration-300">${d.icon}</span>
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white group-hover:text-theme-600 transition-colors">${t(d.roleKey)}</h3>
                    </div>
                    <div class="flex justify-between mb-5 bg-gray-50 dark:bg-gray-700/30 p-3 rounded-xl">
                        <div class="text-center w-1/2 border-r border-gray-200 dark:border-gray-600">
                            <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider block mb-1">${t('role_chief')}</span>
                            <span class="font-bold text-base dark:text-white uppercase">${val(d, 'chief')}</span>
                        </div>
                        ${d.deputy_zh ? `<div class="text-center w-1/2"><span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider block mb-1">${t('role_deputy')}</span><span class="font-bold text-base dark:text-white uppercase">${val(d, 'deputy')}</span></div>` : ''}
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed text-justify">${val(d, 'desc')}</p>
                </div>
            `).join('');
            return `
                <div class="text-center mb-12">
                    <h1 class="text-4xl font-black mb-4 text-theme-600 dark:text-theme-400 tracking-tight">${t('orgTitle')}</h1>
                    <p class="text-gray-500 max-w-2xl mx-auto">å­¸ç”Ÿæœƒç”±æœƒé•·èˆ‡å‰¯æœƒé•·é ˜å°ï¼Œä¸‹è¨­å…­å¤§è·èƒ½éƒ¨é–€ï¼Œå„å¸å…¶è·ï¼Œå…±åŒç‚ºå…¨æ ¡åŒå­¸æœå‹™ã€‚</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto mb-16 animate-fade-in">${leadersHtml}</div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 auto-rows-fr animate-fade-in">${deptsHtml}</div>
            `;
        }

        function renderFinance() {
            const total = APP_DATA.finance.reduce((acc, cur) => acc + Number(cur.amount), 0);
            const rows = APP_DATA.finance.map(f => `
                <tr class="border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition last:border-0">
                    <td class="py-4 px-6 dark:text-gray-300 font-mono text-sm">${f.date}</td>
                    <td class="py-4 px-6 font-bold dark:text-white text-gray-800">${val(f, 'item')}</td>
                    <td class="py-4 px-6 text-right font-mono"><span class="${f.amount > 0 ? 'text-green-600 bg-green-50 dark:bg-green-900/30 ring-1 ring-green-200 dark:ring-green-800' : 'text-red-600 bg-red-50 dark:bg-red-900/30 ring-1 ring-red-200 dark:ring-red-800'} font-bold px-3 py-1 rounded-md text-sm">${f.amount > 0 ? '+' : ''}${f.amount.toLocaleString()}</span></td>
                </tr>
            `).join('');
            
            return `
                <div class="max-w-4xl mx-auto">
                    <h1 class="text-3xl font-black mb-8 text-theme-600 dark:text-theme-400 text-center tracking-tight">${t('financeTitle')}</h1>
                    <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-xl overflow-hidden border border-gray-100 dark:border-gray-700">
                        <div class="p-8 bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-750 border-b border-gray-200 dark:border-gray-700 flex flex-col md:flex-row justify-between items-center gap-6">
                            <div class="flex items-center gap-3">
                                <div class="bg-theme-100 dark:bg-theme-900/30 p-3 rounded-full text-theme-600 dark:text-theme-400"><i data-lucide="pie-chart" class="w-6 h-6"></i></div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 font-medium">æœ¬è¡¨åƒ…åˆ—å‡ºè¿‘æœŸæ”¶æ”¯æ¦‚æ³ï¼Œè©³ç´°å ±è¡¨è«‹è‡³å­¸ç”Ÿæœƒè¾¦å…¬å®¤æŸ¥é–±ã€‚</p>
                            </div>
                            <div class="flex flex-col items-end">
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1">CURRENT BALANCE</span>
                                <div class="flex items-baseline gap-2">
                                    <span class="text-3xl font-black ${total >= 0 ? 'text-theme-600 dark:text-theme-400' : 'text-red-500'} tracking-tight">
                                        ${total > 0 ? '+' : ''}${total.toLocaleString()}
                                    </span>
                                    <span class="text-sm font-bold text-gray-400">TWD</span>
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead class="bg-gray-50 dark:bg-gray-900/50 text-gray-500 dark:text-gray-400 uppercase text-xs font-bold tracking-wider">
                                    <tr>
                                        <th class="py-4 px-6">${t('col_date')}</th>
                                        <th class="py-4 px-6">${t('col_item')}</th>
                                        <th class="py-4 px-6 text-right">${t('col_amount')} (TWD)</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100 dark:divide-gray-800">${rows}</tbody>
                            </table>
                        </div>
                    </div>
                </div>`;
        }

        function renderMailboxes() {
            return `
                <div class="max-w-5xl mx-auto">
                    <h1 class="text-3xl font-black mb-10 text-center text-theme-600 dark:text-theme-400 tracking-tight">${t('mailboxes')}</h1>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-10 rounded-3xl shadow-xl hover:shadow-2xl transition-all border-t-[8px] border-blue-500 flex flex-col items-center text-center transform hover:-translate-y-2 duration-300 group">
                            <div class="bg-blue-50 dark:bg-blue-900/20 p-6 rounded-full mb-6 group-hover:scale-110 transition-transform duration-300"><i data-lucide="scale" class="w-12 h-12 text-blue-500"></i></div>
                            <h2 class="text-2xl font-black mb-3 dark:text-white tracking-tight">${t('rightsMailbox')}</h2>
                            <p class="text-gray-500 dark:text-gray-400 mb-8 flex-grow leading-relaxed max-w-sm">${t('rightsDesc')}</p>
                            <a href="https://forms.gle/HAxbZJCiCEFhVkwV6" target="_blank" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 rounded-xl transition flex justify-center items-center gap-2 shadow-lg shadow-blue-500/30 transform active:scale-95 text-lg">${t('goToForm')} <i data-lucide="arrow-right" class="w-5 h-5"></i></a>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-10 rounded-3xl shadow-xl hover:shadow-2xl transition-all border-t-[8px] border-pink-500 flex flex-col items-center text-center transform hover:-translate-y-2 duration-300 group">
                            <div class="bg-pink-50 dark:bg-pink-900/20 p-6 rounded-full mb-6 group-hover:scale-110 transition-transform duration-300"><i data-lucide="ghost" class="w-12 h-12 text-pink-500"></i></div>
                            <h2 class="text-2xl font-black mb-3 dark:text-white tracking-tight">${t('anonMailbox')}</h2>
                            <p class="text-gray-500 dark:text-gray-400 mb-8 flex-grow leading-relaxed max-w-sm">${t('anonDesc')}</p>
                            <a href="https://forms.gle/L8v7cPxDGP8wfYnJ6" target="_blank" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-4 rounded-xl transition flex justify-center items-center gap-2 shadow-lg shadow-pink-500/30 transform active:scale-95 text-lg">${t('goToForm')} <i data-lucide="arrow-right" class="w-5 h-5"></i></a>
                        </div>
                    </div>
                </div>`;
        }
        
        function renderClubs() {
            const clubList = APP_DATA.clubs.map(c => `
                <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-md p-8 flex flex-col items-center text-center hover:shadow-2xl transition-all duration-300 group border border-gray-100 dark:border-gray-700 hover:border-theme-300 relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent to-gray-50 dark:to-gray-700/30 opacity-0 group-hover:opacity-100 transition duration-500"></div>
                    <div class="w-36 h-36 rounded-full overflow-hidden mb-6 border-8 border-gray-50 dark:border-gray-700 shadow-inner group-hover:border-theme-100 transition-colors duration-300 flex items-center justify-center bg-white dark:bg-gray-800 relative z-10">
                        <div class="w-full h-full flex items-center justify-center text-7xl select-none group-hover:scale-110 group-hover:rotate-12 transition duration-500">
                            ${c.emoji}
                        </div>
                    </div>
                    <span class="text-[10px] font-bold bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full text-gray-500 dark:text-gray-300 mb-3 tracking-widest uppercase relative z-10">${c.category}</span>
                    <h3 class="font-black dark:text-white text-xl mb-6 relative z-10 tracking-tight">${val(c, 'name')}</h3>
                    <a href="${c.ig}" target="_blank" class="w-full py-2.5 rounded-xl bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gradient-to-r hover:from-purple-500 hover:to-pink-500 hover:text-white transition-all flex items-center justify-center gap-2 font-bold group-hover:shadow-md relative z-10">
                        <i data-lucide="instagram" class="w-4 h-4"></i> Follow
                    </a>
                </div>
            `).join('');
            return `<h1 class="text-3xl font-black mb-10 text-theme-600 dark:text-theme-400 text-center tracking-tight">${t('clubTitle')}</h1><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 px-4">${clubList}</div>`;
        }

        function renderDownloads() {
            const list = APP_DATA.downloads.map(d => `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm flex flex-col sm:flex-row items-start sm:items-center justify-between border border-gray-100 dark:border-gray-700 hover:border-theme-400 hover:shadow-lg transition-all group gap-4">
                    <div class="flex items-center gap-5">
                        <div class="bg-theme-50 dark:bg-theme-900/30 p-4 rounded-2xl text-theme-600 dark:text-theme-400 group-hover:bg-theme-500 group-hover:text-white transition duration-300"><i data-lucide="file-text" class="w-6 h-6"></i></div>
                        <div>
                            <h3 class="font-bold text-lg dark:text-white group-hover:text-theme-600 dark:group-hover:text-theme-400 transition-colors">${val(d, 'title')}</h3>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-xs font-mono text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded">${d.date}</span>
                                <span class="text-xs text-gray-400 font-medium">â€¢ ${isEn() ? d.type : (d.type==='Academic'?'æ•™å‹™':d.type==='Event'?'æ´»å‹•':'å…¶ä»–')}</span>
                            </div>
                        </div>
                    </div>
                    <a href="${d.file}" target="_blank" class="w-full sm:w-auto bg-gray-50 dark:bg-gray-700 hover:bg-theme-500 hover:text-white text-gray-600 dark:text-gray-300 px-6 py-3 rounded-xl transition font-bold flex items-center justify-center gap-2 group-hover:shadow-md">
                        <span class="hidden sm:inline">${t('download_btn')}</span> <i data-lucide="download" class="w-4 h-4"></i>
                    </a>
                </div>
            `).join('');
            return `
                <div class="max-w-4xl mx-auto">
                    <h1 class="text-3xl font-black mb-8 text-center text-theme-600 dark:text-theme-400 tracking-tight">${t('downloadTitle')}</h1>
                    <div class="space-y-4 animate-fade-in">${list}</div>
                </div>`;
        }

        function renderContact() {
            return `
                <div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 p-10 rounded-3xl shadow-xl border border-gray-100 dark:border-gray-700 relative overflow-hidden">
                    <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-theme-100 dark:bg-theme-900/30 rounded-full blur-2xl"></div>
                    
                    <h1 class="text-3xl font-black mb-8 text-center text-theme-600 dark:text-theme-400 tracking-tight relative z-10">${t('contact')}</h1>
                    <div class="space-y-4 relative z-10">
                        <a href="https://www.instagram.com/pksh.su/" target="_blank" class="flex items-center p-5 bg-gradient-to-r from-gray-50 to-white dark:from-gray-700 dark:to-gray-800 border border-gray-100 dark:border-gray-600 rounded-2xl hover:border-pink-300 transition-all group shadow-sm hover:shadow-md">
                            <div class="bg-white p-3 rounded-xl shadow-sm group-hover:scale-110 transition-transform mr-5">
                                <i data-lucide="instagram" class="w-8 h-8 text-pink-500"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-xl dark:text-white group-hover:text-pink-500 transition-colors">Instagram</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400 font-mono mt-0.5">@pksh.su</p>
                            </div>
                            <i data-lucide="arrow-right" class="ml-auto w-5 h-5 text-gray-300 group-hover:text-pink-500 group-hover:translate-x-1 transition-all"></i>
                        </a>
                        
                        <a href="mailto:pkshsu@pksh.ylc.edu.tw" class="flex items-center p-5 bg-gradient-to-r from-gray-50 to-white dark:from-gray-700 dark:to-gray-800 border border-gray-100 dark:border-gray-600 rounded-2xl hover:border-theme-300 transition-all group shadow-sm hover:shadow-md">
                            <div class="bg-white p-3 rounded-xl shadow-sm group-hover:scale-110 transition-transform mr-5">
                                <i data-lucide="mail" class="w-8 h-8 text-theme-500"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-xl dark:text-white group-hover:text-theme-600 transition-colors">Email</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400 font-mono mt-0.5">pkshsu@pksh.ylc.edu.tw</p>
                            </div>
                            <i data-lucide="arrow-right" class="ml-auto w-5 h-5 text-gray-300 group-hover:text-theme-500 group-hover:translate-x-1 transition-all"></i>
                        </a>
                    </div>
                    
                    <div class="pt-8 mt-8 border-t border-gray-100 dark:border-gray-700 text-center">
                        <button onclick="navigate('admin')" class="text-xs font-bold text-gray-400 hover:text-theme-500 flex items-center justify-center transition mx-auto gap-1 py-2 px-4 rounded-full hover:bg-gray-50 dark:hover:bg-gray-700/50">
                            <i data-lucide="shield" class="w-3 h-3"></i> ${t('admin')}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderMeetings() {
            const list = APP_DATA.meetings.length ? APP_DATA.meetings.map(m => `
                <div class="flex items-center justify-between bg-white dark:bg-gray-800 p-5 rounded-2xl shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-all cursor-pointer border border-gray-100 dark:border-gray-700 hover:border-theme-300 group">
                    <div class="flex items-center gap-5">
                        <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-xl text-gray-500 dark:text-gray-300 group-hover:bg-theme-500 group-hover:text-white transition-colors">
                            <i data-lucide="file-text" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h3 class="font-bold dark:text-white text-lg group-hover:text-theme-600 transition-colors">${val(m, 'title')}</h3>
                            <p class="text-xs text-gray-400 font-mono mt-1">${m.date}</p>
                        </div>
                    </div>
                    <a href="${m.file}" target="_blank" class="text-theme-600 hover:bg-theme-500 hover:text-white px-4 py-2 rounded-lg text-sm font-bold transition-all border border-theme-200">
                        Open PDF
                    </a>
                </div>
            `).join('') : `<div class="text-center py-20 bg-gray-50 dark:bg-gray-800/50 rounded-3xl"><p class="text-gray-400 font-medium">æš«ç„¡å…¬é–‹çš„æœƒè­°è¨˜éŒ„ã€‚</p></div>`;
            return `
                <div class="max-w-3xl mx-auto">
                    <h1 class="text-3xl font-black mb-8 text-theme-600 dark:text-theme-400 text-center tracking-tight">${t('meetingTitle')}</h1>
                    <div class="space-y-4 animate-fade-in">${list}</div>
                </div>`;
        }

        // --- Admin System ---
        function renderAdmin() {
            if (!APP_STATE.user) {
                // Login Form
                return `
                    <div class="max-w-sm mx-auto bg-white dark:bg-gray-800 p-10 rounded-3xl shadow-2xl border border-gray-100 dark:border-gray-700 mt-20 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-theme-400 to-blue-500"></div>
                        <h1 class="text-3xl font-black mb-8 dark:text-white text-center tracking-tight">${t('login_title')}</h1>
                        <form onsubmit="handleLogin(event)" class="space-y-6">
                            <div>
                                <label class="block text-xs font-bold mb-2 dark:text-gray-300 uppercase tracking-widest text-gray-500">${t('login_email')}</label>
                                <input type="email" id="admin-email" required class="w-full p-3.5 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl dark:text-white focus:outline-none focus:ring-2 focus:ring-theme-500 focus:border-transparent transition-all shadow-inner" placeholder="admin@pksh.su">
                            </div>
                            <div>
                                <label class="block text-xs font-bold mb-2 dark:text-gray-300 uppercase tracking-widest text-gray-500">${t('login_pwd')}</label>
                                <input type="password" id="admin-pwd" required class="w-full p-3.5 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl dark:text-white focus:outline-none focus:ring-2 focus:ring-theme-500 focus:border-transparent transition-all shadow-inner" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                            </div>
                            <button type="submit" class="w-full bg-gradient-to-r from-theme-500 to-theme-700 text-white py-4 rounded-xl hover:shadow-lg hover:scale-[1.02] active:scale-95 transition-all font-bold text-lg shadow-theme-500/30">${t('login_btn')}</button>
                        </form>
                    </div>
                `;
            } else {
                const tab = APP_STATE.adminTab;
                let contentHtml = '';

                const inputStyle = "w-full p-3 rounded-xl border border-gray-200 dark:border-gray-700 dark:bg-gray-900 dark:text-white focus:ring-2 focus:ring-theme-500 focus:outline-none transition-shadow";
                const labelStyle = "block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1.5 ml-1";
                const btnStyle = "bg-theme-500 hover:bg-theme-700 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all active:scale-95 w-full md:w-auto";

                if (tab === 'news') {
                    const list = APP_DATA.announcements.filter(a => a.id && !a.id.startsWith('static_')).map(a => `
                         <div class="flex justify-between items-center bg-gray-50 dark:bg-gray-900 p-4 rounded-xl border border-gray-100 dark:border-gray-700 group hover:border-theme-200 transition mb-3">
                            <div><p class="font-bold dark:text-white">${a.title_zh}</p><span class="text-xs text-gray-400 font-mono">${a.date}</span></div>
                            <button onclick="deleteItem('announcements', '${a.id}')" class="text-gray-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-lg transition"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                         </div>
                    `).join('');
                    contentHtml = `
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-full">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700">
                                <h3 class="font-bold mb-6 text-xl dark:text-white flex items-center gap-2"><i data-lucide="plus-circle" class="text-theme-500"></i> æ–°å¢å…¬å‘Š</h3>
                                <div class="space-y-4">
                                    <div><label class="${labelStyle}">æ—¥æœŸ</label><input id="news-date" type="date" class="${inputStyle}"></div>
                                    <div><label class="${labelStyle}">ä¸­æ–‡æ¨™é¡Œ</label><input id="news-title-zh" class="${inputStyle}" placeholder="è¼¸å…¥æ¨™é¡Œ..."></div>
                                    <div class="flex gap-2 items-end">
                                        <div class="flex-grow"><label class="${labelStyle}">English Title</label><input id="news-title-en" class="${inputStyle}" placeholder="Auto translate..."></div>
                                        <button onclick="autoTranslate('news-title-zh', 'news-title-en')" class="h-[50px] px-4 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-100 transition"><i data-lucide="languages"></i></button>
                                    </div>
                                    <div><label class="${labelStyle}">ä¸­æ–‡å…§å®¹</label><textarea id="news-content-zh" class="${inputStyle} h-24" placeholder="æ”¯æ´ HTML..."></textarea></div>
                                    <div class="flex gap-2 items-start">
                                        <div class="flex-grow"><label class="${labelStyle}">English Content</label><textarea id="news-content-en" class="${inputStyle} h-24"></textarea></div>
                                        <button onclick="autoTranslate('news-content-zh', 'news-content-en')" class="mt-8 h-[50px] px-4 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-100 transition"><i data-lucide="languages"></i></button>
                                    </div>
                                    <button onclick="addNews()" class="${btnStyle} mt-2 w-full"><i data-lucide="save" class="inline w-4 h-4 mr-2"></i> ç™¼å¸ƒå…¬å‘Š</button>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col h-[600px]">
                                <h3 class="font-bold mb-4 text-xl dark:text-white">å·²ç™¼å¸ƒåˆ—è¡¨</h3>
                                <div class="overflow-y-auto flex-grow pr-2 space-y-1 custom-scrollbar">${list || `<div class="h-full flex items-center justify-center text-gray-400">æš«ç„¡è³‡æ–™</div>`}</div>
                            </div>
                        </div>
                    `;
                }
                else if (tab === 'events') {
                     const list = APP_DATA.events.filter(e => e.id && !e.id.startsWith('e')).map(e => `
                         <div class="flex justify-between items-center bg-gray-50 dark:bg-gray-900 p-4 rounded-xl border border-gray-100 dark:border-gray-700 group hover:border-theme-200 transition mb-3">
                            <div><p class="font-bold dark:text-white">${e.title_zh}</p><span class="text-xs text-gray-400">${e.date} | ${e.type}</span></div>
                            <button onclick="deleteItem('events', '${e.id}')" class="text-gray-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-lg transition"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                         </div>
                    `).join('');
                    contentHtml = `
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-full">
                             <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700">
                                <h3 class="font-bold mb-6 text-xl dark:text-white flex items-center gap-2"><i data-lucide="calendar-plus" class="text-theme-500"></i> æ–°å¢æ´»å‹•</h3>
                                <div class="space-y-4">
                                    <div><label class="${labelStyle}">ä¸­æ–‡åç¨±</label><input id="event-title-zh" class="${inputStyle}"></div>
                                    <div class="flex gap-2 items-end"><div class="flex-grow"><label class="${labelStyle}">English Title</label><input id="event-title-en" class="${inputStyle}"></div><button onclick="autoTranslate('event-title-zh', 'event-title-en')" class="h-[50px] px-4 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-100 transition"><i data-lucide="languages"></i></button></div>
                                    <div class="flex gap-4">
                                        <div class="w-1/2"><label class="${labelStyle}">æ—¥æœŸ</label><input id="event-date" type="date" class="${inputStyle}"></div>
                                        <div class="w-1/2"><label class="${labelStyle}">æ™‚é–“</label><input id="event-time" class="${inputStyle}" placeholder="ex: 08:00"></div>
                                    </div>
                                    <div><label class="${labelStyle}">åœ°é»</label><input id="event-loc" class="${inputStyle}"></div>
                                    <div><label class="${labelStyle}">é€£çµ (é¸å¡«)</label><input id="event-link" class="${inputStyle}" placeholder="https://..."></div>
                                    <div><label class="${labelStyle}">é¡å‹</label><select id="event-type" class="${inputStyle}"><option value="Activity">Activity (æ´»å‹•)</option><option value="Academic">Academic (æ•™å‹™)</option><option value="Holiday">Holiday (å‡æ—¥)</option></select></div>
                                    <button onclick="addEvent()" class="${btnStyle} mt-2 w-full">ç™¼å¸ƒæ´»å‹•</button>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col h-[600px]">
                                <h3 class="font-bold mb-4 text-xl dark:text-white">æ´»å‹•åˆ—è¡¨</h3>
                                <div class="overflow-y-auto flex-grow pr-2 custom-scrollbar">${list || `<div class="h-full flex items-center justify-center text-gray-400">æš«ç„¡è³‡æ–™</div>`}</div>
                            </div>
                        </div>
                    `;
                }
                else if (tab === 'photos') {
                    const list = APP_DATA.photos ? APP_DATA.photos.map(p => `
                        <div class="flex justify-between items-center bg-gray-50 dark:bg-gray-900 p-3 rounded-xl border border-gray-100 dark:border-gray-700 mb-3">
                            <div class="flex items-center gap-4">
                                <img src="${p.url}" class="w-12 h-12 object-cover rounded-lg">
                                <p class="font-bold dark:text-white text-sm truncate w-32">${p.title_zh}</p>
                            </div>
                            <button onclick="deleteItem('photos', '${p.id}')" class="text-gray-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-lg"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>
                    `).join('') : '';
                    contentHtml = `
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-full">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700">
                                <h3 class="font-bold mb-6 text-xl dark:text-white flex items-center gap-2"><i data-lucide="image-plus" class="text-theme-500"></i> æ–°å¢ç…§ç‰‡</h3>
                                <div class="space-y-4">
                                    <div><label class="${labelStyle}">åœ–ç‰‡ç¶²å€ (URL)</label><input id="photo-url" class="${inputStyle}" placeholder="https://..."></div>
                                    <div><label class="${labelStyle}">ä¸­æ–‡æ¨™é¡Œ</label><input id="photo-title-zh" class="${inputStyle}"></div>
                                    <div><label class="${labelStyle}">English Title</label><input id="photo-title-en" class="${inputStyle}"></div>
                                    <button onclick="addPhoto()" class="${btnStyle} mt-2 w-full">æ–°å¢ç…§ç‰‡</button>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col h-[600px]">
                                <h3 class="font-bold mb-4 text-xl dark:text-white">ç…§ç‰‡åˆ—è¡¨</h3>
                                <div class="overflow-y-auto flex-grow pr-2 custom-scrollbar">${list || `<div class="h-full flex items-center justify-center text-gray-400">æš«ç„¡è³‡æ–™</div>`}</div>
                            </div>
                        </div>
                    `;
                }
                else if (tab === 'finance') {
                    const list = APP_DATA.finance.map(f => `
                        <div class="flex justify-between items-center bg-gray-50 dark:bg-gray-900 p-4 rounded-xl border border-gray-100 dark:border-gray-700 mb-3">
                            <div><p class="font-bold dark:text-white">${f.item_zh}</p><span class="text-xs text-gray-400">${f.date} | $${f.amount}</span></div>
                            <button onclick="deleteItem('finance', '${f.id}')" class="text-gray-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-lg"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>
                    `).join('');
                    contentHtml = `
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-full">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700">
                                <h3 class="font-bold mb-6 text-xl dark:text-white flex items-center gap-2"><i data-lucide="dollar-sign" class="text-theme-500"></i> æ–°å¢æ”¶æ”¯</h3>
                                <div class="space-y-4">
                                    <div><label class="${labelStyle}">æ—¥æœŸ</label><input id="fin-date" type="date" class="${inputStyle}"></div>
                                    <div><label class="${labelStyle}">é …ç›®åç¨±</label><input id="fin-item" class="${inputStyle}"></div>
                                    <div class="flex gap-4">
                                        <div class="w-2/3"><label class="${labelStyle}">é‡‘é¡</label><input id="fin-amount" type="number" class="${inputStyle}" placeholder="1000"></div>
                                        <div class="w-1/3"><label class="${labelStyle}">é¡å‹</label><select id="fin-type" class="${inputStyle}"><option value="In">æ”¶å…¥ (+)</option><option value="Out">æ”¯å‡º (-)</option></select></div>
                                    </div>
                                    <button onclick="addFinance()" class="${btnStyle} mt-2 w-full">æ–°å¢ç´€éŒ„</button>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col h-[600px]">
                                <h3 class="font-bold mb-4 text-xl dark:text-white">è²¡å‹™åˆ—è¡¨</h3>
                                <div class="overflow-y-auto flex-grow pr-2 custom-scrollbar">${list}</div>
                            </div>
                        </div>
                    `;
                }
                else if (tab === 'meetings') {
                     const list = APP_DATA.meetings.map(m => `
                        <div class="flex justify-between items-center bg-gray-50 dark:bg-gray-900 p-4 rounded-xl border border-gray-100 dark:border-gray-700 mb-3">
                            <div><p class="font-bold dark:text-white">${m.title_zh}</p><span class="text-xs text-gray-400">${m.date}</span></div>
                            <button onclick="deleteItem('meetings', '${m.id}')" class="text-gray-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-lg"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>
                    `).join('');
                    contentHtml = `
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-full">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700">
                                <h3 class="font-bold mb-6 text-xl dark:text-white flex items-center gap-2"><i data-lucide="file-plus" class="text-theme-500"></i> ä¸Šå‚³æœƒè­°è¨˜éŒ„</h3>
                                <div class="space-y-4">
                                    <div><label class="${labelStyle}">æ—¥æœŸ</label><input id="mt-date" type="date" class="${inputStyle}"></div>
                                    <div><label class="${labelStyle}">æ¨™é¡Œ</label><input id="mt-title" class="${inputStyle}"></div>
                                    <div><label class="${labelStyle}">æª”æ¡ˆé€£çµ (Google Drive)</label><input id="mt-link" class="${inputStyle}" placeholder="https://..."></div>
                                    <button onclick="addMeeting()" class="${btnStyle} mt-2 w-full">ç™¼å¸ƒç´€éŒ„</button>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col h-[600px]">
                                <h3 class="font-bold mb-4 text-xl dark:text-white">è¨˜éŒ„åˆ—è¡¨</h3>
                                <div class="overflow-y-auto flex-grow pr-2 custom-scrollbar">${list}</div>
                            </div>
                        </div>
                    `;
                }
                else if (tab === 'downloads') {
                     const list = APP_DATA.downloads.map(d => `
                        <div class="flex justify-between items-center bg-gray-50 dark:bg-gray-900 p-4 rounded-xl border border-gray-100 dark:border-gray-700 mb-3">
                            <div><p class="font-bold dark:text-white">${d.title_zh}</p><span class="text-xs text-gray-400">${d.type}</span></div>
                            <button onclick="deleteItem('downloads', '${d.id}')" class="text-gray-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-lg"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>
                    `).join('');
                    contentHtml = `
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-full">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700">
                                <h3 class="font-bold mb-6 text-xl dark:text-white flex items-center gap-2"><i data-lucide="folder-plus" class="text-theme-500"></i> æ–°å¢ä¸‹è¼‰è³‡æº</h3>
                                <div class="space-y-4">
                                    <div><label class="${labelStyle}">æ—¥æœŸ</label><input id="dl-date" type="date" class="${inputStyle}"></div>
                                    <div><label class="${labelStyle}">æ¨™é¡Œ</label><input id="dl-title" class="${inputStyle}"></div>
                                    <div><label class="${labelStyle}">æª”æ¡ˆé€£çµ</label><input id="dl-link" class="${inputStyle}" placeholder="https://..."></div>
                                    <div><label class="${labelStyle}">é¡å‹</label><select id="dl-type" class="${inputStyle}"><option value="Event">Event (æ´»å‹•)</option><option value="Academic">Academic (æ•™å‹™)</option><option value="Other">Other (å…¶ä»–)</option></select></div>
                                    <button onclick="addDownload()" class="${btnStyle} mt-2 w-full">ç™¼å¸ƒè³‡æº</button>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col h-[600px]">
                                <h3 class="font-bold mb-4 text-xl dark:text-white">è³‡æºåˆ—è¡¨</h3>
                                <div class="overflow-y-auto flex-grow pr-2 custom-scrollbar">${list}</div>
                            </div>
                        </div>
                    `;
                }
                else if (tab === 'system') {
                    let marqueeVal = '';
                    if(Array.isArray(SYSTEM_SETTINGS.marquee)) marqueeVal = SYSTEM_SETTINGS.marquee.join(' | ');
                    else marqueeVal = SYSTEM_SETTINGS.marquee;

                    contentHtml = `
                        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 max-w-2xl mx-auto">
                            <h3 class="font-bold mb-6 dark:text-white text-xl flex items-center gap-2"><i data-lucide="settings" class="text-theme-500"></i> ç³»çµ±å…¨åŸŸè¨­å®š</h3>
                            
                            <div class="mb-8">
                                <label class="${labelStyle}">é¦–é è·‘é¦¬ç‡ˆå…§å®¹</label>
                                <textarea id="system-marquee" rows="4" class="${inputStyle}" placeholder="è¼¸å…¥æ–‡å­—... è‹¥è¦åˆ†æ®µé¡¯ç¤ºï¼Œè«‹ä½¿ç”¨ | ç¬¦è™Ÿåˆ†éš”">${marqueeVal}</textarea>
                                <p class="text-xs text-gray-400 mt-2 ml-1"><i data-lucide="info" class="inline w-3 h-3"></i> æç¤ºï¼šä½¿ç”¨ " | " ç¬¦è™Ÿä¾†åˆ†éš”å¤šæ®µè·‘é¦¬ç‡ˆè¨Šæ¯ã€‚</p>
                            </div>

                            <button onclick="saveSystemSettings()" class="${btnStyle} w-full"><i data-lucide="save" class="inline w-4 h-4 mr-1"></i> å„²å­˜è¨­å®š</button>
                        </div>
                    `;
                }

                const navBtn = (key, icon, label) => `
                    <button onclick="switchAdminTab('${key}')" class="text-left px-4 py-3 rounded-xl transition-all flex items-center gap-3 font-bold ${tab===key ? 'bg-theme-500 text-white shadow-md' : 'text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'}">
                        <i data-lucide="${icon}" class="w-5 h-5"></i> ${label}
                    </button>
                `;

                return `
                    <div class="bg-white dark:bg-gray-900 rounded-[2rem] shadow-2xl flex flex-col md:flex-row overflow-hidden border border-gray-100 dark:border-gray-800 min-h-[80vh]">
                        <div class="w-full md:w-64 bg-gray-50 dark:bg-gray-950 p-6 flex flex-col gap-1 border-r border-gray-100 dark:border-gray-800">
                            <div class="mb-8 px-2">
                                <h2 class="text-2xl font-black text-theme-600 dark:text-theme-400 tracking-tight">${t('admin_dashboard')}</h2>
                                <p class="text-xs text-gray-400 mt-1 truncate font-mono">${APP_STATE.user.email}</p>
                            </div>
                            ${navBtn('news', 'bell', t('admin_news'))}
                            ${navBtn('events', 'calendar', t('admin_events'))}
                            ${navBtn('photos', 'image', t('admin_photos'))}
                            ${navBtn('finance', 'dollar-sign', t('admin_finance'))}
                            ${navBtn('meetings', 'file-text', t('admin_meetings'))}
                            ${navBtn('downloads', 'download', t('admin_downloads'))}
                            ${navBtn('system', 'settings', t('admin_system'))}
                            
                            <div class="mt-auto pt-6 border-t border-gray-200 dark:border-gray-800">
                                <button onclick="handleLogout()" class="w-full text-left px-4 py-3 rounded-xl text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 font-bold transition flex items-center gap-3">
                                    <i data-lucide="log-out" class="w-5 h-5"></i> ${t('admin_logout')}
                                </button>
                            </div>
                        </div>
                        <div class="flex-grow p-8 bg-white dark:bg-gray-900 overflow-y-auto">
                            ${contentHtml}
                        </div>
                    </div>
                `;
            }
        }

        // --- Core Render ---
        function render() {
            const container = document.getElementById('app-container');
            const view = APP_STATE.view;
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const isActive = btn.dataset.key === view;
                if(isActive) btn.classList.add('bg-theme-50', 'dark:bg-theme-900/30', 'text-theme-600', 'dark:text-theme-400');
                else btn.classList.remove('bg-theme-50', 'dark:bg-theme-900/30', 'text-theme-600', 'dark:text-theme-400');
            });
            updateMarquee();
            
            document.querySelectorAll('.nav-btn').forEach(el => {
                 if(I18N[APP_STATE.lang][el.dataset.key]) el.innerText = I18N[APP_STATE.lang][el.dataset.key];
            });
            document.querySelectorAll('#mobile-menu button').forEach(el => {
                if(el.dataset.key && I18N[APP_STATE.lang][el.dataset.key]) el.innerText = I18N[APP_STATE.lang][el.dataset.key];
            });

            const routes = {
                'home': renderHome, 'events': renderEvents, 'mailboxes': renderMailboxes,
                'gallery': renderGallery,
                'org': renderOrg, 'finance': renderFinance, 'clubs': renderClubs, 'downloads': renderDownloads,
                'contact': renderContact, 'meetings': renderMeetings, 'admin': renderAdmin
            };
            
            // å®‰å…¨æ¸²æŸ“
            try {
                container.innerHTML = routes[view] ? routes[view]() : renderHome();
            } catch (e) {
                console.error("Render Error:", e);
                container.innerHTML = `<div class="p-10 text-center text-red-500">é é¢è¼‰å…¥éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚<br><small>${e.message}</small></div>`;
            }
            
            lucide.createIcons();
            window.scrollTo(0,0);
        }

        window.navigate = (view) => {
            APP_STATE.view = view;
            APP_STATE.eventFilter = 'All'; 
            document.getElementById('mobile-menu').classList.add('hidden');
            render();
        };

        window.toggleLang = () => {
            APP_STATE.lang = APP_STATE.lang === 'zh' ? 'en' : 'zh';
            document.getElementById('lang-display').innerText = APP_STATE.lang.toUpperCase();
            const searchInput = document.getElementById('search-input');
            if(searchInput) searchInput.placeholder = t('searchPlaceholder');
            render();
        };

        window.toggleDarkMode = () => {
            APP_STATE.darkMode = !APP_STATE.darkMode;
            document.documentElement.classList.toggle('dark');
            document.getElementById('dark-icon').classList.toggle('hidden');
            document.getElementById('light-icon').classList.toggle('hidden');
        };

        document.getElementById('menu-button').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });

        // Init
        (async () => {
            await loadDataFromFirebase();
            render();
        })();
    </script>
</body>
</html>
